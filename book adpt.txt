-- 1️⃣ Create tables
CREATE TABLE STUDENT7 (
    REGNO VARCHAR(10) PRIMARY KEY,
    NAME VARCHAR(20) NOT NULL,
    MAJOR VARCHAR(20) NOT NULL,
    DOB DATE
);

CREATE TABLE COURSE7 (
    COURSENO INT PRIMARY KEY,
    CNAME VARCHAR(20) NOT NULL,
    DEPT VARCHAR(30)
);

CREATE TABLE ENROLL7 (
    REGNO VARCHAR(10),
    COURSENO INT,
    SEM INT,
    MARKS INT,
    PRIMARY KEY (REGNO, COURSENO),
    FOREIGN KEY (REGNO) REFERENCES STUDENT7(REGNO),
    FOREIGN KEY (COURSENO) REFERENCES COURSE7(COURSENO)
);

CREATE TABLE TEXT7 (
    BKISBN BIGINT PRIMARY KEY,
    BOOK_TITLE VARCHAR(20) NOT NULL,
    PUBLISHER VARCHAR(50) NOT NULL,
    AUTHOR VARCHAR(50) NOT NULL
);

CREATE TABLE BOOK_ADPT7 (
    COURSENO INT,
    BKISBN BIGINT,
    SEM INT,
    PRIMARY KEY (COURSENO, BKISBN),
    FOREIGN KEY (COURSENO) REFERENCES COURSE7(COURSENO),
    FOREIGN KEY (BKISBN) REFERENCES TEXT7(BKISBN)
);

-- 2️⃣ Parameterized insertions
-- STUDENT7
INSERT INTO STUDENT7 VALUES('&REGNO', '&NAME', '&MAJOR', '&DOB');

-- COURSE7
INSERT INTO COURSE7 VALUES(&COURSENO, '&CNAME', '&DEPT');

-- ENROLL7
INSERT INTO ENROLL7 VALUES('&REGNO', &COURSENO, &SEM, &MARKS);

-- TEXT7
INSERT INTO TEXT7 VALUES(&BKISBN, '&BOOK_TITLE', '&PUBLISHER', '&AUTHOR');

-- BOOK_ADPT7
INSERT INTO BOOK_ADPT7 VALUES(&COURSENO, &BKISBN, &SEM);

-- 3️⃣ Create view
CREATE VIEW COMPDEPT7 AS
SELECT C.DEPT, C.COURSENO, T.BOOK_TITLE, T.BKISBN
FROM COURSE7 C
JOIN BOOK_ADPT7 BA ON C.COURSENO = BA.COURSENO
JOIN TEXT7 T ON BA.BKISBN = T.BKISBN
WHERE DEPT = 'COMPUTER'
ORDER BY T.BOOK_TITLE;

-- 4️⃣ Queries
-- Select all from view
SELECT * FROM COMPDEPT7;

-- Courses with at least 2 books
SELECT COURSENO, BKISBN, BOOK_TITLE
FROM COMPDEPT7
WHERE DEPT IN (
    SELECT DEPT
    FROM COMPDEPT7
    GROUP BY DEPT
    HAVING COUNT(*) >= 2
);

-- Books by publisher 'HIMALAYA'
SELECT C.DEPT, T.BOOK_TITLE, T.PUBLISHER
FROM COURSE7 C
JOIN BOOK_ADPT7 B ON C.COURSENO = B.COURSENO
JOIN TEXT7 T ON B.BKISBN = T.BKISBN
WHERE T.PUBLISHER = 'HIMALAYA';
